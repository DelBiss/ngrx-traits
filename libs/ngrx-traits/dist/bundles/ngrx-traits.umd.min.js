!(function (e, t) {
  'object' == typeof exports && 'undefined' != typeof module
    ? t(
        exports,
        require('@ngrx/store'),
        require('@angular/core'),
        require('@ngrx/effects'),
        require('rxjs/operators')
      )
    : 'function' == typeof define && define.amd
    ? define(
        'ngrx-traits',
        [
          'exports',
          '@ngrx/store',
          '@angular/core',
          '@ngrx/effects',
          'rxjs/operators',
        ],
        t
      )
    : t(
        ((e = 'undefined' != typeof globalThis ? globalThis : e || self)[
          'ngrx-traits'
        ] = {}),
        e.store,
        e.ng.core,
        e.effects,
        e.rxjs.operators
      );
})(this, function (e, t, r, n, o) {
  'use strict';
  /*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */ Object.create;
  function i(e) {
    var t = 'function' == typeof Symbol && Symbol.iterator,
      r = t && e[t],
      n = 0;
    if (r) return r.call(e);
    if (e && 'number' == typeof e.length)
      return {
        next: function () {
          return (
            e && n >= e.length && (e = void 0), { value: e && e[n++], done: !e }
          );
        },
      };
    throw new TypeError(
      t ? 'Object is not iterable.' : 'Symbol.iterator is not defined.'
    );
  }
  function c(e, t) {
    var r = 'function' == typeof Symbol && e[Symbol.iterator];
    if (!r) return e;
    var n,
      o,
      i = r.call(e),
      c = [];
    try {
      for (; (void 0 === t || t-- > 0) && !(n = i.next()).done; )
        c.push(n.value);
    } catch (e) {
      o = { error: e };
    } finally {
      try {
        n && !n.done && (r = i.return) && r.call(i);
      } finally {
        if (o) throw o.error;
      }
    }
    return c;
  }
  function u() {
    for (var e = [], t = 0; t < arguments.length; t++)
      e = e.concat(c(arguments[t]));
    return e;
  }
  Object.create;
  function a(e) {
    for (
      var t,
        r = [],
        n = function (n) {
          var o,
            c,
            u = e[n];
          if (!(null === (t = u.depends) || void 0 === t ? void 0 : t.length))
            return r.push(u), 'continue';
          if (u.depends.length > 1) {
            var a = function (t) {
              if (
                e.some(function (e) {
                  return e.key === t;
                })
              )
                return (u.depends = [t]), 'break';
            };
            try {
              for (
                var s = ((o = void 0), i(u.depends)), l = s.next();
                !l.done;
                l = s.next()
              ) {
                if ('break' === a(l.value)) break;
              }
            } catch (e) {
              o = { error: e };
            } finally {
              try {
                l && !l.done && (c = s.return) && c.call(s);
              } finally {
                if (o) throw o.error;
              }
            }
          }
          if (u.depends.length > 1)
            throw Error('could not find dependencies ' + u.depends.join(' '));
          r.some(function (e) {
            var t;
            return (
              e.key ===
              (null === (t = null == u ? void 0 : u.depends) || void 0 === t
                ? void 0
                : t[0])
            );
          })
            ? r.push(u)
            : (delete e[n], e.push(u));
        },
        o = 0;
      o < e.length;
      o++
    )
      n(o);
    return r;
  }
  function s(e, r) {
    var n = {};
    for (var o in r) n[o] = t.createSelector(e, r[o]);
    return n;
  }
  var l = (function () {
    function e(e, t) {
      (this.actions$ = e),
        (this.store = t),
        (this.name = this.constructor.name),
        (this.componentId = '');
    }
    return (
      (e.prototype.ngrxOnIdentifyEffects = function () {
        return this.componentId ? this.name + this.componentId : '';
      }),
      (e.prototype.ngrxOnRunEffects = function (e) {
        return this.componentId
          ? e.pipe(
              o.takeUntil(this.actions$.pipe(n.ofType(f(this.componentId))))
            )
          : e;
      }),
      e
    );
  })();
  function f(e) {
    return '[' + e + '] Destroyed';
  }
  (l.decorators = [{ type: r.Injectable }]),
    (l.ctorParameters = function () {
      return [{ type: n.Actions }, { type: t.Store }];
    });
  var d = 0;
  function v(e, o, i, c) {
    var a,
      s = e.get(t.ReducerManager),
      l = e.get(n.EffectSources),
      v = e.get(t.Store),
      p = o + '_' + d++,
      y = i({
        featureSelector: t.createFeatureSelector(p),
        actionsGroupKey: '[' + p + ']',
      });
    y.reducer && s.addReducer(p, y.reducer);
    var g = null == c ? void 0 : c(y.actions, y.selectors),
      h =
        (y.effects &&
          u(
            y.effects.map(function (e) {
              return { provide: e };
            })
          )) ||
        [];
    g && h.push({ provide: g });
    var b = r.Injector.create({ providers: h, parent: e });
    if (
      (null === (a = y.effects) ||
        void 0 === a ||
        a.forEach(function (e) {
          var t = b.get(e);
          (t.componentId = p), l.addEffects(t);
        }),
      c)
    ) {
      var m = b.get(g);
      (m.componentId = p), l.addEffects(m);
    }
    return Object.assign(
      {
        destroy: function () {
          v.dispatch({ type: f(p) }),
            setTimeout(function () {
              return s.removeReducer(p);
            });
        },
      },
      y
    );
  }
  var p = (function () {
    function e(e) {
      this.injector = e;
      var t = this.setup();
      (this.traits = v(
        this.injector,
        t.componentName,
        t.traitsFactory,
        t.effectFactory
      )),
        (this.actions = this.traits.actions),
        (this.selectors = this.traits.selectors);
    }
    return (
      (e.prototype.ngOnDestroy = function () {
        this.traits.destroy();
      }),
      e
    );
  })();
  (p.decorators = [{ type: r.Injectable }]),
    (p.ctorParameters = function () {
      return [{ type: r.Injector }];
    }),
    (e.TraitEffect = l),
    (e.TraitsLocalStore = p),
    (e.buildLocalTraits = v),
    (e.createEntityFeatureFactory = function () {
      for (var e = [], r = 0; r < arguments.length; r++) e[r] = arguments[r];
      return function (r) {
        var n = a(u(e)),
          o = n.reduce(function (e, t) {
            return (e[t.key] = t.config), e;
          }, {}),
          i = n.reduce(function (e, t) {
            var n,
              i,
              c =
                null !==
                  (i =
                    null === (n = null == t ? void 0 : t.actions) ||
                    void 0 === n
                      ? void 0
                      : n.call(t, {
                          actionsGroupKey: r.actionsGroupKey,
                          allConfigs: o,
                        })) && void 0 !== i
                  ? i
                  : {};
            return (c = e ? Object.assign(Object.assign({}, e), c) : c);
          }, {}),
          c = n.reduce(function (e, t) {
            var r,
              n,
              i =
                null !==
                  (n =
                    null === (r = null == t ? void 0 : t.selectors) ||
                    void 0 === r
                      ? void 0
                      : r.call(t, { previousSelectors: e, allConfigs: o })) &&
                void 0 !== n
                  ? n
                  : {};
            return (i = e ? Object.assign(Object.assign({}, e), i) : i);
          }, {}),
          l = n.reduce(function (e, t) {
            var r,
              n,
              i =
                null !==
                  (n =
                    null === (r = null == t ? void 0 : t.mutators) ||
                    void 0 === r
                      ? void 0
                      : r.call(t, {
                          allSelectors: c,
                          previousMutators: e,
                          allConfigs: o,
                        })) && void 0 !== n
                  ? n
                  : {};
            return (i = e ? Object.assign(Object.assign({}, e), i) : i);
          }, {}),
          f = n.reduce(function (e, t) {
            var r, n, i;
            return null !==
              (i =
                null !==
                  (n =
                    null === (r = null == t ? void 0 : t.initialState) ||
                    void 0 === r
                      ? void 0
                      : r.call(t, {
                          previousInitialState: e,
                          allConfigs: o,
                        })) && void 0 !== n
                  ? n
                  : e) && void 0 !== i
              ? i
              : {};
          }, {}),
          d = n.reduce(function (e, t) {
            var r,
              n =
                null === (r = null == t ? void 0 : t.reducer) || void 0 === r
                  ? void 0
                  : r.call(t, {
                      initialState: f,
                      allActions: i,
                      allSelectors: c,
                      allMutators: l,
                      allConfigs: o,
                    });
            return n && e
              ? function (t, r) {
                  void 0 === t && (t = f);
                  var o = e(t, r);
                  return n(o, r);
                }
              : null != n
              ? n
              : e;
          }, void 0),
          v = c && s(r.featureSelector, c),
          p = n.reduce(function (e, t) {
            var r,
              n,
              c =
                null !==
                  (n =
                    null === (r = null == t ? void 0 : t.effects) ||
                    void 0 === r
                      ? void 0
                      : r.call(t, {
                          allActions: i,
                          allSelectors: v,
                          allConfigs: o,
                        })) && void 0 !== n
                  ? n
                  : [];
            return (c = e ? u(e, c) : c);
          }, []);
        return {
          actions: i,
          selectors: v,
          mutators: l,
          initialState: f,
          reducer: null != d ? d : t.createReducer(f),
          effects: p,
        };
      };
    }),
    (e.createTraitFactory = function (e) {
      return e;
    }),
    (e.getDestroyActionName = f),
    (e.insertIf = function (e, t) {
      return e ? [t()] : [];
    }),
    (e.joinReducers = function (e, t) {
      return function (r, n) {
        var o = e(r, n);
        return t(o, n);
      };
    }),
    (e.setPropertiesReducer = function (e, t) {
      return function (r, n) {
        var o = Object.assign({}, e(r, n));
        for (var i in t) o[i] = t[i](o[i], n);
        return o;
      };
    }),
    (e.setPropertyReducer = function (e, t, r) {
      return function (n, o) {
        var i,
          c = e(n, o);
        return Object.assign(
          Object.assign({}, c),
          (((i = {})[t] = r(c[t], o)), i)
        );
      };
    }),
    (e.toMap = function (e) {
      return e.reduce(function (e, t) {
        return (e[t] = !0), e;
      }, {});
    }),
    Object.defineProperty(e, '__esModule', { value: !0 });
});
//# sourceMappingURL=ngrx-traits.umd.min.js.map
