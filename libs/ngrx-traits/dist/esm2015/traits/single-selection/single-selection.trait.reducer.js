import { createReducer, on } from '@ngrx/store';
import { insertIf } from 'ngrx-traits';
export function createSingleSelectionInitialState(
  previousInitialState,
  allConfigs
) {
  var _a;
  const selectedId =
    (_a = allConfigs.singleSelection) === null || _a === void 0
      ? void 0
      : _a.selectedId;
  return Object.assign(Object.assign({}, previousInitialState), { selectedId });
}
export function createSingleSelectionTraitReducer(
  initialState,
  allActions,
  allMutators,
  allConfigs
) {
  var _a, _b;
  const { adapter } = allConfigs.loadEntities;
  const sortRemote =
    (_a = allConfigs.sort) === null || _a === void 0 ? void 0 : _a.remote;
  const paginationCacheType =
    (_b = allConfigs.pagination) === null || _b === void 0
      ? void 0
      : _b.cacheType;
  return createReducer(
    initialState,
    on(allActions.select, (state, { id }) => allMutators.select(id, state)),
    on(allActions.deselect, (state) => allMutators.deselect(state)),
    on(allActions.toggleSelect, (state, { id }) =>
      allMutators.toggleSelect(id, state)
    ),
    ...insertIf(allActions.removeAll, () =>
      on(allActions.removeAll, (state) => allMutators.deselect(state))
    ),
    ...insertIf(sortRemote, () =>
      on(allActions.sort, (state) => allMutators.deselect(state))
    ),
    ...insertIf(allActions.filter, () =>
      on(allActions.filter, (state) => allMutators.deselect(state))
    ),
    ...insertIf(!allActions.loadPageSuccess, () =>
      on(allActions.fetchSuccess, (state) => allMutators.deselect(state))
    ),
    ...insertIf(
      allActions.loadPageSuccess && paginationCacheType === 'partial',
      () =>
        on(allActions.loadPageSuccess, (state) => allMutators.deselect(state))
    ),
    ...insertIf(allActions.remove, () =>
      on(allActions.remove, (state, { keys }) => {
        const shouldDeselect = keys.some((v) => v === state.selectedId);
        return shouldDeselect
          ? Object.assign(Object.assign({}, state), { selectedId: undefined })
          : state;
      })
    ),
    ...insertIf(allActions.update, () =>
      on(allActions.update, (state, { updates }) => {
        const change = updates.find((updated) => {
          const id = adapter.selectId(updated.changes);
          return id && id !== updated.id && state.selectedId === updated.id;
        });
        return change
          ? Object.assign(Object.assign({}, state), {
              selectedId: adapter.selectId(change.changes),
            })
          : state;
      })
    )
  );
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2luZ2xlLXNlbGVjdGlvbi50cmFpdC5yZWR1Y2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vdHJhaXRzL3NyYy9zaW5nbGUtc2VsZWN0aW9uL3NpbmdsZS1zZWxlY3Rpb24udHJhaXQucmVkdWNlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsYUFBYSxFQUFFLEVBQUUsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQWFoRCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBT3ZDLE1BQU0sVUFBVSxpQ0FBaUMsQ0FDL0Msb0JBQXlCLEVBQ3pCLFVBQXNDOztJQUV0QyxNQUFNLFVBQVUsU0FBRyxVQUFVLENBQUMsZUFBZSwwQ0FBRSxVQUFVLENBQUM7SUFDMUQsdUNBQ0ssb0JBQW9CLEtBQ3ZCLFVBQVUsSUFDVjtBQUNKLENBQUM7QUFDRCxNQUFNLFVBQVUsaUNBQWlDLENBSS9DLFlBQWUsRUFDZixVQUs2QixFQUM3QixXQUE0QyxFQUM1QyxVQUd5Qjs7SUFFekIsTUFBTSxFQUFFLE9BQU8sRUFBRSxHQUFHLFVBQVUsQ0FBQyxZQUFhLENBQUM7SUFFN0MsTUFBTSxVQUFVLFNBQUcsVUFBVSxDQUFDLElBQUksMENBQUUsTUFBTSxDQUFDO0lBQzNDLE1BQU0sbUJBQW1CLFNBQUcsVUFBVSxDQUFDLFVBQVUsMENBQUUsU0FBUyxDQUFDO0lBRTdELE9BQU8sYUFBYSxDQUNsQixZQUFZLEVBQ1osRUFBRSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxLQUFLLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUMsRUFDdkUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsRUFDL0Qs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b24gfSBmcm9tICdAbmdyeC9zdG9yZSc7XG5pbXBvcnQge1xuICBMb2FkRW50aXRpZXNBY3Rpb25zLFxuICBMb2FkRW50aXRpZXNLZXllZENvbmZpZyxcbn0gZnJvbSAnLi4vbG9hZC1lbnRpdGllcy9sb2FkLWVudGl0aWVzLm1vZGVsJztcbmltcG9ydCB7IFNvcnRBY3Rpb25zLCBTb3J0S2V5ZWRDb25maWcgfSBmcm9tICcuLi9zb3J0L3NvcnQubW9kZWwnO1xuaW1wb3J0IHtcbiAgRW50aXR5QW5kU2luZ2xlU2VsZWN0aW9uU3RhdGUsXG4gIFNpbmdsZVNlbGVjdGlvbkFjdGlvbnMsXG4gIFNpbmdsZVNlbGVjdGlvbktleWVkQ29uZmlnLFxuICBTaW5nbGVTZWxlY3Rpb25NdXRhdG9ycyxcbn0gZnJvbSAnLi9zaW5nbGUtc2VsZWN0aW9uLm1vZGVsJztcbmltcG9ydCB7IENydWRBY3Rpb25zIH0gZnJvbSAnLi4vY3J1ZC9jcnVkLm1vZGVsJztcbmltcG9ydCB7IGluc2VydElmIH0gZnJvbSAnbmdyeC10cmFpdHMnO1xuaW1wb3J0IHtcbiAgUGFnaW5hdGlvbkFjdGlvbnMsXG4gIFBhZ2luYXRpb25LZXllZENvbmZpZyxcbn0gZnJvbSAnLi4vcGFnaW5hdGlvbi9wYWdpbmF0aW9uLm1vZGVsJztcbmltcG9ydCB7IEZpbHRlckFjdGlvbnMgfSBmcm9tICcuLi9maWx0ZXInO1xuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlU2luZ2xlU2VsZWN0aW9uSW5pdGlhbFN0YXRlPEVudGl0eT4oXG4gIHByZXZpb3VzSW5pdGlhbFN0YXRlOiBhbnksXG4gIGFsbENvbmZpZ3M6IFNpbmdsZVNlbGVjdGlvbktleWVkQ29uZmlnLFxuKTogRW50aXR5QW5kU2luZ2xlU2VsZWN0aW9uU3RhdGU8RW50aXR5PiB7XG4gIGNvbnN0IHNlbGVjdGVkSWQgPSBhbGxDb25maWdzLnNpbmdsZVNlbGVjdGlvbj8uc2VsZWN0ZWRJZDtcbiAgcmV0dXJuIHtcbiAgICAuLi5wcmV2aW91c0luaXRpYWxTdGF0ZSxcbiAgICBzZWxlY3RlZElkLFxuICB9O1xufVxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVNpbmdsZVNlbGVjdGlvblRyYWl0UmVkdWNlcjxcbiAgRW50aXR5LFxuICBTIGV4dGVuZHMgRW50aXR5QW5kU2luZ2xlU2VsZWN0aW9uU3RhdGU8RW50aXR5Pixcbj4oXG4gIGluaXRpYWxTdGF0ZTogUyxcbiAgYWxsQWN0aW9uczogU2luZ2xlU2VsZWN0aW9uQWN0aW9ucyAmXG4gICAgQ3J1ZEFjdGlvbnM8RW50aXR5PiAmXG4gICAgU29ydEFjdGlvbnM8RW50aXR5PiAmXG4gICAgUGFnaW5hdGlvbkFjdGlvbnMgJlxuICAgIEZpbHRlckFjdGlvbnM8YW55PiAmXG4gICAgTG9hZEVudGl0aWVzQWN0aW9uczxFbnRpdHk+LFxuICBhbGxNdXRhdG9yczogU2luZ2xlU2VsZWN0aW9uTXV0YXRvcnM8RW50aXR5PixcbiAgYWxsQ29uZmlnczogU2luZ2xlU2VsZWN0aW9uS2V5ZWRDb25maWcgJlxuICAgIExvYWRFbnRpdGllc0tleWVkQ29uZmlnPEVudGl0eT4gJlxuICAgIFBhZ2luYXRpb25LZXllZENvbmZpZyAmXG4gICAgU29ydEtleWVkQ29uZmlnPEVudGl0eT4sXG4pIHtcbiAgY29uc3QgeyBhZGFwdGVyIH0gPSBhbGxDb25maWdzLmxvYWRFbnRpdGllcyE7XG5cbiAgY29uc3Qgc29ydFJlbW90ZSA9IGFsbENvbmZpZ3Muc29ydD8ucmVtb3RlO1xuICBjb25zdCBwYWdpbmF0aW9uQ2FjaGVUeXBlID0gYWxsQ29uZmlncy5wYWdpbmF0aW9uPy5jYWNoZVR5cGU7XG5cbiAgcmV0dXJuIGNyZWF0ZVJlZHVjZXIoXG4gICAgaW5pdGlhbFN0YXRlLFxuICAgIG9uKGFsbEFjdGlvbnMuc2VsZWN0LCAoc3RhdGUsIHsgaWQgfSkgPT4gYWxsTXV0YXRvcnMuc2VsZWN0KGlkLCBzdGF0ZSkpLFxuICAgIG9uKGFsbEFjdGlvbnMuZGVzZWxlY3QsIChzdGF0ZSkgPT4gYWxsTXV0YXRvcnMuZGVzZWxlY3Qoc3RhdGUpKSxcbiAgICBvbihhbGxBY3Rpb25zLnRvZ2dsZVNlbGVjdCwgKHN0YXRlLCB7IGlkIH0pID0+XG4gICAgICBhbGxNdXRhdG9ycy50b2dnbGVTZWxlY3QoaWQsIHN0YXRlKSxcbiAgICApLFxuICAgIC4uLmluc2VydElmPFM+KGFsbEFjdGlvbnMucmVtb3ZlQWxsLCAoKSA9PlxuICAgICAgb24oYWxsQWN0aW9ucy5yZW1vdmVBbGwsIChzdGF0ZSkgPT4gYWxsTXV0YXRvcnMuZGVzZWxlY3Qoc3RhdGUpKSxcbiAgICApLFxuICAgIC4uLmluc2VydElmPFM+KHNvcnRSZW1vdGUsICgpID0+XG4gICAgICBvbihhbGxBY3Rpb25zLnNvcnQsIChzdGF0ZSkgPT4gYWxsTXV0YXRvcnMuZGVzZWxlY3Qoc3RhdGUpKSxcbiAgICApLFxuICAgIC4uLmluc2VydElmPFM+KGFsbEFjdGlvbnMuZmlsdGVyLCAoKSA9PlxuICAgICAgb24oYWxsQWN0aW9ucy5maWx0ZXIsIChzdGF0ZSkgPT4gYWxsTXV0YXRvcnMuZGVzZWxlY3Qoc3RhdGUpKSxcbiAgICApLFxuICAgIC4uLmluc2VydElmPFM+KCFhbGxBY3Rpb25zLmxvYWRQYWdlU3VjY2VzcywgKCkgPT5cbiAgICAgIG9uKGFsbEFjdGlvbnMuZmV0Y2hTdWNjZXNzLCAoc3RhdGUpID0+IGFsbE11dGF0b3JzLmRlc2VsZWN0KHN0YXRlKSksXG4gICAgKSxcbiAgICAuLi5pbnNlcnRJZjxTPihcbiAgICAgIGFsbEFjdGlvbnMubG9hZFBhZ2VTdWNjZXNzICYmIHBhZ2luYXRpb25DYWNoZVR5cGUgPT09ICdwYXJ0aWFsJyxcbiAgICAgICgpID0+XG4gICAgICAgIG9uKGFsbEFjdGlvbnMubG9hZFBhZ2VTdWNjZXNzLCAoc3RhdGUpID0+IGFsbE11dGF0b3JzLmRlc2VsZWN0KHN0YXRlKSksXG4gICAgKSxcbiAgICAuLi5pbnNlcnRJZjxTPihhbGxBY3Rpb25zLnJlbW92ZSwgKCkgPT5cbiAgICAgIG9uKGFsbEFjdGlvbnMucmVtb3ZlLCAoc3RhdGUsIHsga2V5cyB9KSA9PiB7XG4gICAgICAgIGNvbnN0IHNob3VsZERlc2VsZWN0ID0ga2V5cy5zb21lKFxuICAgICAgICAgICh2OiBzdHJpbmcgfCBudW1iZXIpID0+IHYgPT09IHN0YXRlLnNlbGVjdGVkSWQsXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiBzaG91bGREZXNlbGVjdFxuICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgICAgICAgc2VsZWN0ZWRJZDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgfVxuICAgICAgICAgIDogc3RhdGU7XG4gICAgICB9KSxcbiAgICApLFxuICAgIC4uLmluc2VydElmPFM+KGFsbEFjdGlvbnMudXBkYXRlLCAoKSA9PlxuICAgICAgb24oYWxsQWN0aW9ucy51cGRhdGUsIChzdGF0ZSwgeyB1cGRhdGVzIH0pID0+IHtcbiAgICAgICAgY29uc3QgY2hhbmdlID0gdXBkYXRlcy5maW5kKCh1cGRhdGVkKSA9PiB7XG4gICAgICAgICAgY29uc3QgaWQgPSBhZGFwdGVyLnNlbGVjdElkKHVwZGF0ZWQuY2hhbmdlcyBhcyBFbnRpdHkpO1xuICAgICAgICAgIHJldHVybiBpZCAmJiBpZCAhPT0gdXBkYXRlZC5pZCAmJiBzdGF0ZS5zZWxlY3RlZElkID09PSB1cGRhdGVkLmlkO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGNoYW5nZVxuICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgICAgICAgc2VsZWN0ZWRJZDogYWRhcHRlci5zZWxlY3RJZChjaGFuZ2UuY2hhbmdlcyBhcyBFbnRpdHkpLFxuICAgICAgICAgICAgfVxuICAgICAgICAgIDogc3RhdGU7XG4gICAgICB9KSxcbiAgICApLFxuICApO1xufVxuIl19
