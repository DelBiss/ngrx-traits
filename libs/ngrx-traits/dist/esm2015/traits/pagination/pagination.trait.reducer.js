import { createReducer, on } from '@ngrx/store';
import { insertIf } from 'ngrx-traits';
export function createPaginationInitialState(previousInitialState, allConfigs) {
  const { currentPage, pageSize, cacheType, pagesToCache } =
    allConfigs.pagination;
  return Object.assign(Object.assign({}, previousInitialState), {
    pagination: {
      pageSize,
      currentPage,
      requestPage: currentPage,
      pagesToCache,
      cache: {
        type: cacheType,
        start: 0,
        end: 0,
      },
    },
  });
}
export function createPaginationTraitReducer(
  initialState,
  allActions,
  allSelectors,
  allMutators,
  allConfigs
) {
  var _a;
  function addToCacheTotal(state, add) {
    var _a;
    return Object.assign(Object.assign({}, state), {
      pagination: Object.assign(Object.assign({}, state.pagination), {
        total:
          ((_a = state.pagination.total) !== null && _a !== void 0 ? _a : 0) +
          add,
      }),
    });
  }
  function clearPagesCache(state) {
    return Object.assign(Object.assign({}, state), {
      entities: {},
      ids: [],
      pagination: Object.assign(Object.assign({}, state.pagination), {
        currentPage: 0,
        total: 0,
        cache: Object.assign(Object.assign({}, state.pagination.cache), {
          start: 0,
          end: 0,
        }),
      }),
    });
  }
  function recalculateTotal(state) {
    const total = allSelectors.selectTotal(state);
    return Object.assign(Object.assign({}, state), {
      status: 'success',
      pagination: Object.assign(Object.assign({}, state.pagination), {
        currentPage: 0,
        total,
        cache: Object.assign(Object.assign({}, state.pagination.cache), {
          start: 0,
          end: total,
        }),
      }),
    });
  }
  const filterRemote = !((_a =
    allConfigs === null || allConfigs === void 0
      ? void 0
      : allConfigs.filter) === null || _a === void 0
    ? void 0
    : _a.filterFn);
  return createReducer(
    initialState,
    on(allActions.loadPage, (state, { index }) =>
      Object.assign(Object.assign({}, state), {
        pagination: Object.assign(Object.assign({}, state.pagination), {
          currentPage: index,
          requestPage: index,
        }),
        status: 'loading',
      })
    ),
    on(allActions.setRequestPage, (state, { index }) =>
      Object.assign(Object.assign({}, state), {
        pagination: Object.assign(Object.assign({}, state.pagination), {
          requestPage: index,
        }),
        status: 'loading',
      })
    ),
    on(allActions.loadPageSuccess, (state) =>
      Object.assign(Object.assign({}, state), { status: 'success' })
    ),
    on(allActions.loadPageFail, (state) =>
      Object.assign(Object.assign({}, state), { status: 'fail' })
    ),
    on(allActions.clearPagesCache, (state) => clearPagesCache(state)),
    on(allActions.fetchSuccess, (state, { entities, total }) =>
      allMutators.mergePaginatedEntities(
        entities,
        total,
        Object.assign(Object.assign({}, state), { status: 'success' })
      )
    ),
    ...insertIf(allActions.add, () =>
      on(allActions.add, (state, { entities }) =>
        addToCacheTotal(state, entities.length)
      )
    ),
    ...insertIf(allActions.remove, () =>
      on(allActions.remove, (state, { keys }) =>
        addToCacheTotal(state, -keys.length)
      )
    ),
    ...insertIf(filterRemote && allActions.filter, () =>
      on(allActions.filter, (state) => recalculateTotal(state))
    ),
    ...insertIf(allActions.removeAll, () =>
      on(allActions.removeAll, (state) => clearPagesCache(state))
    )
  );
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnaW5hdGlvbi50cmFpdC5yZWR1Y2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vdHJhaXRzL3NyYy9wYWdpbmF0aW9uL3BhZ2luYXRpb24udHJhaXQucmVkdWNlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsYUFBYSxFQUFFLEVBQUUsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQWVoRCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBRXZDLE1BQU0sVUFBVSw0QkFBNEIsQ0FDMUMsb0JBQXlCLEVBQ3pCLFVBQWlDO0lBRWpDLE1BQU0sRUFBRSxXQUFXLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsR0FDdEQsVUFBVSxDQUFDLFVBQVcsQ0FBQztJQUV6Qix1Q0FDSyxvQkFBb0IsS0FDdkIsVUFBVSxFQUFFO1lBQ1YsUUFBUTtZQUNSLFdBQVc7WUFDWCxXQUFXLEVBQUUsV0FBVztZQUN4QixZQUFZO1lBQ1osS0FBSyxFQUFFO2dCQUNMLElBQUksRUFBRSxTQUFTO2dCQUNmLEtBQUssRUFBRSxDQUFDO2dCQUNSLEdBQUcsRUFBRSxDQUFDO2FBQ1A7U0FDRixJQUNEO0FBQ0osQ0FBQztBQUVELE1BQU0sVUFBVSw0QkFBNEIsQ0FJMUMsWUFBZSxFQUNmLFVBR3FCLEVBQ3JCLFlBQTJDLEVBQzNDLFdBQXNFLEVBQ3RFLFVBRXVCOztJQUV2QixTQUFTLGVBQWUsQ0FDdEIsS0FBUSxFQUNSLEdBQVc7O1FBRVgsdUNBQ0ssS0FBSyxLQUNSLFVBQVUsa0NBQ0wsS0FBSyxDQUFDLFVBQVUsS0FDbkIsS0FBSyxFQUFFLE9BQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxLQUFLLG1DQUFJLENBQUMsQ0FBQyxHQUFHLEdBQUcsT0FFNUM7SUFDSixDQUFDO0lBRUQsU0FBUyxlQUFlLENBQ3RCLEtBQVE7UUFFUix1Q0FDSyxLQUFLLEtBQ1IsUUFBUSxFQUFFLEVBQUUsRUFDWixHQUFH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SUFBSSxVQUFVLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxDQUNyRCxFQUFFLENBQUMsVUFBVSxDQUFDLE1BQU0sRUFBRSxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FDMUQsRUFDRCxHQUFHLFFBQVEsQ0FBSSxVQUFVLENBQUMsU0FBUyxFQUFFLEdBQUcsRUFBRSxDQUN4QyxFQUFFLENBQUMsVUFBVSxDQUFDLFNBQVMsRUFBRSxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQzVELENBQ0YsQ0FBQztBQUNKLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBGaWx0ZXJBY3Rpb25zLCBGaWx0ZXJLZXllZENvbmZpZyB9IGZyb20gJy4uL2ZpbHRlci9maWx0ZXIubW9kZWwnO1xuaW1wb3J0IHsgY3JlYXRlUmVkdWNlciwgb24gfSBmcm9tICdAbmdyeC9zdG9yZSc7XG5cbmltcG9ydCB7XG4gIExvYWRFbnRpdGllc0FjdGlvbnMsXG4gIExvYWRFbnRpdGllc0tleWVkQ29uZmlnLFxuICBMb2FkRW50aXRpZXNNdXRhdG9ycyxcbiAgTG9hZEVudGl0aWVzU2VsZWN0b3JzLFxufSBmcm9tICcuLi9sb2FkLWVudGl0aWVzL2xvYWQtZW50aXRpZXMubW9kZWwnO1xuaW1wb3J0IHtcbiAgRW50aXR5QW5kUGFnaW5hdGlvblN0YXRlLFxuICBQYWdpbmF0aW9uS2V5ZWRDb25maWcsXG4gIFBhZ2luYXRpb25NdXRhdG9ycyxcbn0gZnJvbSAnLi9wYWdpbmF0aW9uLm1vZGVsJztcbmltcG9ydCB7IENydWRBY3Rpb25zIH0gZnJvbSAnLi4vY3J1ZCc7XG5pbXBvcnQgeyDGn1BhZ2luYXRpb25BY3Rpb25zIH0gZnJvbSAnLi9wYWdpbmF0aW9uLm1vZGVsLmludGVybmFsJztcbmltcG9ydCB7IGluc2VydElmIH0gZnJvbSAnbmdyeC10cmFpdHMnO1xuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlUGFnaW5hdGlvbkluaXRpYWxTdGF0ZTxFbnRpdHk+KFxuICBwcmV2aW91c0luaXRpYWxTdGF0ZTogYW55LFxuICBhbGxDb25maWdzOiBQYWdpbmF0aW9uS2V5ZWRDb25maWcsXG4pOiBFbnRpdHlBbmRQYWdpbmF0aW9uU3RhdGU8RW50aXR5PiB7XG4gIGNvbnN0IHsgY3VycmVudFBhZ2UsIHBhZ2VTaXplLCBjYWNoZVR5cGUsIHBhZ2VzVG9DYWNoZSB9ID1cbiAgICBhbGxDb25maWdzLnBhZ2luYXRpb24hO1xuXG4gIHJldHVybiB7XG4gICAgLi4ucHJldmlvdXNJbml0aWFsU3RhdGUsXG4gICAgcGFnaW5hdGlvbjoge1xuICAgICAgcGFnZVNpemUsXG4gICAgICBjdXJyZW50UGFnZSxcbiAgICAgIHJlcXVlc3RQYWdlOiBjdXJyZW50UGFnZSxcbiAgICAgIHBhZ2VzVG9DYWNoZSxcbiAgICAgIGNhY2hlOiB7XG4gICAgICAgIHR5cGU6IGNhY2hlVHlwZSxcbiAgICAgICAgc3RhcnQ6IDAsXG4gICAgICAgIGVuZDogMCxcbiAgICAgIH0sXG4gICAgfSxcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVBhZ2luYXRpb25UcmFpdFJlZHVjZXI8XG4gIEVudGl0eSxcbiAgUyBleHRlbmRzIEVudGl0eUFuZFBhZ2luYXRpb25TdGF0ZTxFbnRpdHk+LFxuPihcbiAgaW5pdGlhbFN0YXRlOiBTLFxuICBhbGxBY3Rpb25zOiDGn1BhZ2luYXRpb25BY3Rpb25zICZcbiAgICBGaWx0ZXJBY3Rpb25zPEVudGl0eT4gJlxuICAgIExvYWRFbnRpdGllc0FjdGlvbnM8RW50aXR5PiAmXG4gICAgQ3J1ZEFjdGlvbnM8RW50aXR5PixcbiAgYWxsU2VsZWN0b3JzOiBMb2FkRW50aXRpZXNTZWxlY3RvcnM8RW50aXR5PixcbiAgYWxsTXV0YXRvcnM6IFBhZ2luYXRpb25NdXRhdG9yczxFbnRpdHk+ICYgTG9hZEVudGl0aWVzTXV0YXRvcnM8RW50aXR5PixcbiAgYWxsQ29uZmlnczogRmlsdGVyS2V5ZWRDb25maWc8RW50aXR5LCB1bmtub3duPiAmXG4gICAgTG9hZEVudGl0aWVzS2V5ZWRDb25maWc8RW50aXR5PiAmXG4gICAgUGFnaW5hdGlvbktleWVkQ29uZmlnLFxuKSB7XG4gIGZ1bmN0aW9uIGFkZFRvQ2FjaGVUb3RhbDxTIGV4dGVuZHMgRW50aXR5QW5kUGFnaW5hdGlvblN0YXRlPEVudGl0eT4+KFxuICAgIHN0YXRlOiBTLFxuICAgIGFkZDogbnVtYmVyLFxuICApIHtcbiAgICByZXR1cm4ge1xuICAgICAgLi4uc3RhdGUsXG4gICAgICBwYWdpbmF0aW9uOiB7XG4gICAgICAgIC4uLnN0YXRlLnBhZ2luYXRpb24sXG4gICAgICAgIHRvdGFsOiAoc3RhdGUucGFnaW5hdGlvbi50b3RhbCA/PyAwKSArIGFkZCxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNsZWFyUGFnZXNDYWNoZTxTIGV4dGVuZHMgRW50aXR5QW5kUGFnaW5hdGlvblN0YXRlPEVudGl0eT4+KFxuICAgIHN0YXRlOiBTLFxuICApOiBTIHtcbiAgICByZXR1cm4ge1xuICAgICAgLi4uc3RhdGUsXG4gICAgICBlbnRpdGllczoge30sXG4gICAgICBpZHM6IFtdLFxuICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICAuLi5zdGF0ZS5wYWdpbmF0aW9uLFxuICAgICAgICBjdXJyZW50UGFnZTogMCxcbiAgICAgICAgdG90YWw6IDAsXG4gICAgICAgIGNhY2hlOiB7IC4uLnN0YXRlLnBhZ2luYXRpb24uY2FjaGUsIHN0YXJ0OiAwLCBlbmQ6IDAgfSxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlY2FsY3VsYXRlVG90YWw8UyBleHRlbmRzIEVudGl0eUFuZFBhZ2luYXRpb25TdGF0ZTxFbnRpdHk+PihcbiAgICBzdGF0ZTogUyxcbiAgKTogUyB7XG4gICAgY29uc3QgdG90YWwgPSBhbGxTZWxlY3RvcnMuc2VsZWN0VG90YWwoc3RhdGUpO1xuICAgIHJldHVybiB7XG4gICAgICAuLi5zdGF0ZSxcbiAgICAgIHN0YXR1czogJ3N1Y2Nlc3MnLFxuICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICAuLi5zdGF0ZS5wYWdpbmF0aW9uLFxuICAgICAgICBjdXJyZW50UGFnZTogMCxcbiAgICAgICAgdG90YWwsXG4gICAgICAgIGNhY2hlOiB7XG4gICAgICAgICAgLi4uc3RhdGUucGFnaW5hdGlvbi5jYWNoZSxcbiAgICAgICAgICBzdGFydDogMCxcbiAgICAgICAgICBlbmQ6IHRvdGFsLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgY29uc3QgZmlsdGVyUmVtb3RlID0gIWFsbENvbmZpZ3M/LmZpbHRlcj8uZmlsdGVyRm47XG5cbiAgcmV0dXJuIGNyZWF0ZVJlZHVjZXIoXG4gICAgaW5pdGlhbFN0YXRlLFxuICAgIG9uKGFsbEFjdGlvbnMubG9hZFBhZ2UsIChzdGF0ZSwgeyBpbmRleCB9KSA9PiAoe1xuICAgICAgLi4uc3RhdGUsXG4gICAgICBwYWdpbmF0aW9uOiB7XG4gICAgICAgIC4uLnN0YXRlLnBhZ2luYXRpb24sXG4gICAgICAgIGN1cnJlbnRQYWdlOiBpbmRleCxcbiAgICAgICAgcmVxdWVzdFBhZ2U6IGluZGV4LFxuICAgICAgfSxcbiAgICAgIHN0YXR1czogJ2xvYWRpbmcnLFxuICAgIH0pKSxcbiAgICBvbihhbGxBY3Rpb25zLnNldFJlcXVlc3RQYWdlLCAoc3RhdGUsIHsgaW5kZXggfSkgPT4gKHtcbiAgICAgIC4uLnN0YXRlLFxuICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICAuLi5zdGF0ZS5wYWdpbmF0aW9uLFxuICAgICAgICByZXF1ZXN0UGFnZTogaW5kZXgsXG4gICAgICB9LFxuICAgICAgc3RhdHVzOiAnbG9hZGluZycsXG4gICAgfSkpLFxuICAgIG9uKGFsbEFjdGlvbnMubG9hZFBhZ2VTdWNjZXNzLCAoc3RhdGUpID0+ICh7XG4gICAgICAuLi5zdGF0ZSxcbiAgICAgIHN0YXR1czogJ3N1Y2Nlc3MnLFxuICAgIH0pKSxcbiAgICBvbihhbGxBY3Rpb25zLmxvYWRQYWdlRmFpbCwgKHN0YXRlKSA9PiAoe1xuICAgICAgLi4uc3RhdGUsXG4gICAgICBzdGF0dXM6ICdmYWlsJyxcbiAgICB9KSksXG4gICAgb24oYWxsQWN0aW9ucy5jbGVhclBhZ2VzQ2FjaGUsIChzdGF0ZSkgPT4gY2xlYXJQYWdlc0NhY2hlKHN0YXRlKSksXG4gICAgb24oYWxsQWN0aW9ucy5mZXRjaFN1Y2Nlc3MsIChzdGF0ZSwgeyBlbnRpdGllcywgdG90YWwgfSkgPT5cbiAgICAgIGFsbE11dGF0b3JzLm1lcmdlUGFnaW5hdGVkRW50aXRpZXM8Uz4oZW50aXRpZXMsIHRvdGFsLCB7XG4gICAgICAgIC4uLnN0YXRlLFxuICAgICAgICBzdGF0dXM6ICdzdWNjZXNzJyxcbiAgICAgIH0pLFxuICAgICksXG4gICAgLi4uaW5zZXJ0SWY8Uz4oYWxsQWN0aW9ucy5hZGQsICgpID0+XG4gICAgICBvbihhbGxBY3Rpb25zLmFkZCwgKHN0YXRlLCB7IGVudGl0aWVzIH0pID0+XG4gICAgICAgIGFkZFRvQ2FjaGVUb3RhbChzdGF0ZSwgZW50aXRpZXMubGVuZ3RoKSxcbiAgICAgICksXG4gICAgKSxcbiAgICAuLi5pbnNlcnRJZjxTPihhbGxBY3Rpb25zLnJlbW92ZSwgKCkgPT5cbiAgICAgIG9uKGFsbEFjdGlvbnMucmVtb3ZlLCAoc3RhdGUsIHsga2V5cyB9KSA9PlxuICAgICAgICBhZGRUb0NhY2hlVG90YWwoc3RhdGUsIC1rZXlzLmxlbmd0aCksXG4gICAgICApLFxuICAgICksXG4gICAgLi4uaW5zZXJ0SWY8Uz4oZmlsdGVyUmVtb3RlICYmIGFsbEFjdGlvbnMuZmlsdGVyLCAoKSA9PlxuICAgICAgb24oYWxsQWN0aW9ucy5maWx0ZXIsIChzdGF0ZSkgPT4gcmVjYWxjdWxhdGVUb3RhbChzdGF0ZSkpLFxuICAgICksXG4gICAgLi4uaW5zZXJ0SWY8Uz4oYWxsQWN0aW9ucy5yZW1vdmVBbGwsICgpID0+XG4gICAgICBvbihhbGxBY3Rpb25zLnJlbW92ZUFsbCwgKHN0YXRlKSA9PiBjbGVhclBhZ2VzQ2FjaGUoc3RhdGUpKSxcbiAgICApLFxuICApO1xufVxuIl19
