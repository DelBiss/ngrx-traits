import { insertIf } from 'ngrx-traits';
import { createReducer, on } from '@ngrx/store';
export function createMultiSelectionInitialState(previousInitialState) {
  return Object.assign(Object.assign({}, previousInitialState), {
    selectedIds: {},
  });
}
export function createMultiSelectionTraitReducer(
  initialState,
  allActions,
  allMutators,
  allConfigs
) {
  var _a, _b;
  const { adapter } = allConfigs.loadEntities;
  const sortRemote =
    (_a = allConfigs.sort) === null || _a === void 0 ? void 0 : _a.remote;
  const paginationCacheType =
    (_b = allConfigs.pagination) === null || _b === void 0
      ? void 0
      : _b.cacheType;
  function updateSelectedIdsChanged(state, updates) {
    const changedIds = updates.reduce((acc, updated) => {
      const id = adapter.selectId(updated.changes);
      if (id && id !== updated.id && state.selectedIds[updated.id] != null) {
        acc.push(updated);
        return acc;
      }
      return acc;
    }, []);
    if (changedIds.length) {
      const selectedIds = Object.assign({}, state.selectedIds);
      changedIds.forEach((updated) => {
        const id = adapter.selectId(updated.changes);
        const value = selectedIds[updated.id];
        delete selectedIds[updated.id];
        selectedIds[id] = value;
      });
      return Object.assign(Object.assign({}, state), { selectedIds });
    }
    return state;
  }
  return createReducer(
    initialState,
    on(allActions.multiSelect, (state, { id }) =>
      allMutators.multiSelect(id, state)
    ),
    on(allActions.multiDeselect, (state, { id }) =>
      allMutators.multiDeselect(id, state)
    ),
    on(allActions.multiToggleSelect, (state, { id }) =>
      allMutators.multiToggleSelect(id, state)
    ),
    on(allActions.toggleSelectAll, (state) =>
      allMutators.toggleSelectAll(state)
    ),
    ...insertIf(allActions.remove, () =>
      on(allActions.remove, (state, { keys }) => {
        const selectedIds = Object.assign({}, state.selectedIds);
        keys.forEach((v) => {
          delete selectedIds[v];
        });
        return Object.assign(Object.assign({}, state), { selectedIds });
      })
    ),
    ...insertIf(allActions.update, () =>
      on(allActions.update, (state, { updates }) =>
        updateSelectedIdsChanged(state, updates)
      )
    ),
    on(allActions.multiClearSelection, (state) =>
      allMutators.multiClearSelection(state)
    ),
    ...insertIf(allActions.removeAll, () =>
      on(allActions.removeAll, (state) =>
        allMutators.multiClearSelection(state)
      )
    ),
    ...insertIf(sortRemote, () =>
      on(allActions.sort, (state) => allMutators.multiClearSelection(state))
    ),
    ...insertIf(allActions.filter, () =>
      on(allActions.filter, (state) => allMutators.multiClearSelection(state))
    ),
    ...insertIf(!allActions.loadPageSuccess, () =>
      on(allActions.fetchSuccess, (state) =>
        allMutators.multiClearSelection(state)
      )
    ),
    ...insertIf(
      allActions.loadPageSuccess && paginationCacheType === 'partial',
      () =>
        on(allActions.loadPageSuccess, (state) =>
          allMutators.multiClearSelection(state)
        )
    )
  );
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXVsdGktc2VsZWN0aW9uLnRyYWl0LnJlZHVjZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi90cmFpdHMvc3JjL211bHRpLXNlbGVjdGlvbi9tdWx0aS1zZWxlY3Rpb24udHJhaXQucmVkdWNlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFZQSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQ3ZDLE9BQU8sRUFBRSxhQUFhLEVBQUUsRUFBRSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBT2hELE1BQU0sVUFBVSxnQ0FBZ0MsQ0FDOUMsb0JBQXlCO0lBRXpCLHVDQUNLLG9CQUFvQixLQUN2QixXQUFXLEVBQUUsRUFBRSxJQUNmO0FBQ0osQ0FBQztBQUVELE1BQU0sVUFBVSxnQ0FBZ0MsQ0FJOUMsWUFBZSxFQUNmLFVBS21CLEVBQ25CLFdBQThDLEVBQzlDLFVBRXlCOztJQUV6QixNQUFNLEVBQUUsT0FBTyxFQUFFLEdBQUcsVUFBVSxDQUFDLFlBQWEsQ0FBQztJQUM3QyxNQUFNLFVBQVUsU0FBRyxVQUFVLENBQUMsSUFBSSwwQ0FBRSxNQUFNLENBQUM7SUFDM0MsTUFBTSxtQkFBbUIsU0FBRyxVQUFVLENBQUMsVUFBVSwwQ0FBRSxTQUFTLENBQUM7SUFFN0QsU0FBUyx3QkFBd0IsQ0FFL0IsS0FBUSxFQUFFLE9BQXlCO1FBQ25DLE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsT0FBTyxFQUFFLEVBQUU7WUFDakQsTUFBTSxFQUFFLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsT0FBaUIsQ0FBQyxDQUFDO1lBQ3ZELElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxPQUFPLENBQUMsRUFBRSxJQUFJLEtBQUssQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxJQUFJLElBQUksRUFBRTtnQkFDcEUsR0FBRyxDQUFDLElBQUksQ0FBQyxP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LENBQUksVUFBVSxFQUFFLEdBQUcsRUFBRSxDQUM5QixFQUFFLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsV0FBVyxDQUFDLG1CQUFtQixDQUFDLEtBQUssQ0FBQyxDQUFDLENBQ3ZFLEVBQ0QsR0FBRyxRQUFRLENBQUksVUFBVSxDQUFDLE1BQU0sRUFBRSxHQUFHLEVBQUUsQ0FDckMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLFdBQVcsQ0FBQyxtQkFBbUIsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUN6RSxFQUNELEdBQUcsUUFBUSxDQUFJLENBQUMsVUFBVSxDQUFDLGVBQWUsRUFBRSxHQUFHLEVBQUUsQ0FDL0MsRUFBRSxDQUFDLFVBQVUsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUNwQyxXQUFXLENBQUMsbUJBQW1CLENBQUMsS0FBSyxDQUFDLENBQ3ZDLENBQ0YsRUFDRCxHQUFHLFFBQVEsQ0FDVCxVQUFVLENBQUMsZUFBZSxJQUFJLG1CQUFtQixLQUFLLFNBQVMsRUFDL0QsR0FBRyxFQUFFLENBQ0gsRUFBRSxDQUFDLFVBQVUsQ0FBQyxlQUFlLEVBQUUsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUN2QyxXQUFXLENBQUMsbUJBQW1CLENBQUMsS0FBSyxDQUFDLENBQ3ZDLENBQ0osQ0FDRixDQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIExvYWRFbnRpdGllc0FjdGlvbnMsXG4gIExvYWRFbnRpdGllc0tleWVkQ29uZmlnLFxufSBmcm9tICcuLi9sb2FkLWVudGl0aWVzL2xvYWQtZW50aXRpZXMubW9kZWwnO1xuaW1wb3J0IHsgU29ydEFjdGlvbnMsIFNvcnRLZXllZENvbmZpZyB9IGZyb20gJy4uL3NvcnQvc29ydC5tb2RlbCc7XG5pbXBvcnQge1xuICBFbnRpdHlBbmRNdWx0aXBsZVNlbGVjdGlvblN0YXRlLFxuICBNdWx0aXBsZVNlbGVjdGlvbk11dGF0b3JzLFxuICBNdWx0aVNlbGVjdEFjdGlvbnMsXG59IGZyb20gJy4vbXVsdGktc2VsZWN0aW9uLm1vZGVsJztcbmltcG9ydCB7IENydWRBY3Rpb25zIH0gZnJvbSAnLi4vY3J1ZC9jcnVkLm1vZGVsJztcbmltcG9ydCB7IFVwZGF0ZSB9IGZyb20gJ0BuZ3J4L2VudGl0eS9zcmMvbW9kZWxzJztcbmltcG9ydCB7IGluc2VydElmIH0gZnJvbSAnbmdyeC10cmFpdHMnO1xuaW1wb3J0IHsgY3JlYXRlUmVkdWNlciwgb24gfSBmcm9tICdAbmdyeC9zdG9yZSc7XG5pbXBvcnQge1xuICBQYWdpbmF0aW9uQWN0aW9ucyxcbiAgUGFnaW5hdGlvbktleWVkQ29uZmlnLFxufSBmcm9tICcuLi9wYWdpbmF0aW9uL3BhZ2luYXRpb24ubW9kZWwnO1xuaW1wb3J0IHsgRmlsdGVyQWN0aW9ucyB9IGZyb20gJy4uL2ZpbHRlcic7XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNdWx0aVNlbGVjdGlvbkluaXRpYWxTdGF0ZTxFbnRpdHk+KFxuICBwcmV2aW91c0luaXRpYWxTdGF0ZTogYW55LFxuKTogRW50aXR5QW5kTXVsdGlwbGVTZWxlY3Rpb25TdGF0ZTxFbnRpdHk+IHtcbiAgcmV0dXJuIHtcbiAgICAuLi5wcmV2aW91c0luaXRpYWxTdGF0ZSxcbiAgICBzZWxlY3RlZElkczoge30sXG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNdWx0aVNlbGVjdGlvblRyYWl0UmVkdWNlcjxcbiAgRW50aXR5LFxuICBTIGV4dGVuZHMgRW50aXR5QW5kTXVsdGlwbGVTZWxlY3Rpb25TdGF0ZTxFbnRpdHk+LFxuPihcbiAgaW5pdGlhbFN0YXRlOiBTLFxuICBhbGxBY3Rpb25zOiBNdWx0aVNlbGVjdEFjdGlvbnMgJlxuICAgIENydWRBY3Rpb25zPEVudGl0eT4gJlxuICAgIFNvcnRBY3Rpb25zPEVudGl0eT4gJlxuICAgIExvYWRFbnRpdGllc0FjdGlvbnM8RW50aXR5PiAmXG4gICAgRmlsdGVyQWN0aW9uczxhbnk+ICZcbiAgICBQYWdpbmF0aW9uQWN0aW9ucyxcbiAgYWxsTXV0YXRvcnM6IE11bHRpcGxlU2VsZWN0aW9uTXV0YXRvcnM8RW50aXR5PixcbiAgYWxsQ29uZmlnczogTG9hZEVudGl0aWVzS2V5ZWRDb25maWc8RW50aXR5PiAmXG4gICAgUGFnaW5hdGlvbktleWVkQ29uZmlnICZcbiAgICBTb3J0S2V5ZWRDb25maWc8RW50aXR5Pixcbikge1xuICBjb25zdCB7IGFkYXB0ZXIgfSA9IGFsbENvbmZpZ3MubG9hZEVudGl0aWVzITtcbiAgY29uc3Qgc29ydFJlbW90ZSA9IGFsbENvbmZpZ3Muc29ydD8ucmVtb3RlO1xuICBjb25zdCBwYWdpbmF0aW9uQ2FjaGVUeXBlID0gYWxsQ29uZmlncy5wYWdpbmF0aW9uPy5jYWNoZVR5cGU7XG5cbiAgZnVuY3Rpb24gdXBkYXRlU2VsZWN0ZWRJZHNDaGFuZ2VkPFxuICAgIFMgZXh0ZW5kcyBFbnRpdHlBbmRNdWx0aXBsZVNlbGVjdGlvblN0YXRlPEVudGl0eT4sXG4gID4oc3RhdGU6IFMsIHVwZGF0ZXM6IFVwZGF0ZTxFbnRpdHk+W10pIHtcbiAgICBjb25zdCBjaGFuZ2VkSWRzID0gdXBkYXRlcy5yZWR1Y2UoKGFjYywgdXBkYXRlZCkgPT4ge1xuICAgICAgY29uc3QgaWQgPSBhZGFwdGVyLnNlbGVjdElkKHVwZGF0ZWQuY2hhbmdlcyBhcyBFbnRpdHkpO1xuICAgICAgaWYgKGlkICYmIGlkICE9PSB1cGRhdGVkLmlkICYmIHN0YXRlLnNlbGVjdGVkSWRzW3VwZGF0ZWQuaWRdICE9IG51bGwpIHtcbiAgICAgICAgYWNjLnB1c2godXBkYXRlZCk7XG4gICAgICAgIHJldHVybiBhY2M7XG4gICAgICB9XG4gICAgICByZXR1cm4gYWNjO1xuICAgIH0sIFtdIGFzIFVwZGF0ZTxFbnRpdHk+W10pO1xuICAgIGlmIChjaGFuZ2VkSWRzLmxlbmd0aCkge1xuICAgICAgY29uc3Qgc2VsZWN0ZWRJZHMgPSB7IC4uLnN0YXRlLnNlbGVjdGVkSWRzIH07XG4gICAgICBjaGFuZ2VkSWRzLmZvckVhY2goKHVwZGF0ZWQpID0+IHtcbiAgICAgICAgY29uc3QgaWQgPSBhZGFwdGVyLnNlbGVjdElkKHVwZGF0ZWQuY2hhbmdlcyBhcyBFbnRpdHkpO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IHNlbGVjdGVkSWRzW3VwZGF0ZWQuaWRdO1xuICAgICAgICBkZWxldGUgc2VsZWN0ZWRJZHNbdXBkYXRlZC5pZF07XG4gICAgICAgIHNlbGVjdGVkSWRzW2lkXSA9IHZhbHVlO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4geyAuLi5zdGF0ZSwgc2VsZWN0ZWRJZHMgfTtcbiAgICB9XG5cbiAgICByZXR1cm4gc3RhdGU7XG4gIH1cblxuICByZXR1cm4gY3JlYXRlUmVkdWNlcihcbiAgICBpbml0aWFsU3RhdGUsXG4gICAgb24oYWxsQWN0aW9ucy5tdWx0aVNlbGVjdCwgKHN0YXRlLCB7IGlkIH0pID0+XG4gICAgICBhbGxNdXRhdG9ycy5tdWx0aVNlbGVjdChpZCwgc3RhdGUpLFxuICAgICksXG4gICAgb24oYWxsQWN0aW9ucy5tdWx0aURlc2VsZWN0LCAoc3RhdGUsIHsgaWQgfSkgPT5cbiAgICAgIGFsbE11dGF0b3JzLm11bHRpRGVzZWxlY3QoaWQsIHN0YXRlKSxcbiAgICApLFxuICAgIG9uKGFsbEFjdGlvbnMubXVsdGlUb2dnbGVTZWxlY3QsIChzdGF0ZSwgeyBpZCB9KSA9PlxuICAgICAgYWxsTXV0YXRvcnMubXVsdGlUb2dnbGVTZWxlY3QoaWQsIHN0YXRlKSxcbiAgICApLFxuICAgIG9uKGFsbEFjdGlvbnMudG9nZ2xlU2VsZWN0QWxsLCAoc3RhdGUpID0+XG4gICAgICBhbGxNdXRhdG9ycy50b2dnbGVTZWxlY3RBbGwoc3RhdGUpLFxuICAgICksXG4gICAgLi4uaW5zZXJ0SWY8Uz4oYWxsQWN0aW9ucy5yZW1vdmUsICgpID0+XG4gICAgICBvbihhbGxBY3Rpb25zLnJlbW92ZSwgKHN0YXRlLCB7IGtleXMgfSkgPT4ge1xuICAgICAgICBjb25zdCBzZWxlY3RlZElkcyA9IHsgLi4uc3RhdGUuc2VsZWN0ZWRJZHMgfTtcbiAgICAgICAga2V5cy5mb3JFYWNoKCh2OiBzdHJpbmcgfCBudW1iZXIpID0+IHtcbiAgICAgICAgICBkZWxldGUgc2VsZWN0ZWRJZHNbdl07XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4geyAuLi5zdGF0ZSwgc2VsZWN0ZWRJZHMgfTtcbiAgICAgIH0pLFxuICAgICksXG4gICAgLi4uaW5zZXJ0SWY8Uz4oYWxsQWN0aW9ucy51cGRhdGUsICgpID0+XG4gICAgICBvbihhbGxBY3Rpb25zLnVwZGF0ZSwgKHN0YXRlLCB7IHVwZGF0ZXMgfSkgPT5cbiAgICAgICAgdXBkYXRlU2VsZWN0ZWRJZHNDaGFuZ2VkKHN0YXRlLCB1cGRhdGVzKSxcbiAgICAgICksXG4gICAgKSxcbiAgICBvbihhbGxBY3Rpb25zLm11bHRpQ2xlYXJTZWxlY3Rpb24sIChzdGF0ZSkgPT5cbiAgICAgIGFsbE11dGF0b3JzLm11bHRpQ2xlYXJTZWxlY3Rpb24oc3RhdGUpLFxuICAgICksXG4gICAgLi4uaW5zZXJ0SWY8Uz4oYWxsQWN0aW9ucy5yZW1vdmVBbGwsICgpID0+XG4gICAgICBvbihhbGxBY3Rpb25zLnJlbW92ZUFsbCwgKHN0YXRlKSA9PlxuICAgICAgICBhbGxNdXRhdG9ycy5tdWx0aUNsZWFyU2VsZWN0aW9uKHN0YXRlKSxcbiAgICAgICksXG4gICAgKSxcbiAgICAuLi5pbnNlcnRJZjxTPihzb3J0UmVtb3RlLCAoKSA9PlxuICAgICAgb24oYWxsQWN0aW9ucy5zb3J0LCAoc3RhdGUpID0+IGFsbE11dGF0b3JzLm11bHRpQ2xlYXJTZWxlY3Rpb24oc3RhdGUpKSxcbiAgICApLFxuICAgIC4uLmluc2VydElmPFM+KGFsbEFjdGlvbnMuZmlsdGVyLCAoKSA9PlxuICAgICAgb24oYWxsQWN0aW9ucy5maWx0ZXIsIChzdGF0ZSkgPT4gYWxsTXV0YXRvcnMubXVsdGlDbGVhclNlbGVjdGlvbihzdGF0ZSkpLFxuICAgICksXG4gICAgLi4uaW5zZXJ0SWY8Uz4oIWFsbEFjdGlvbnMubG9hZFBhZ2VTdWNjZXNzLCAoKSA9PlxuICAgICAgb24oYWxsQWN0aW9ucy5mZXRjaFN1Y2Nlc3MsIChzdGF0ZSkgPT5cbiAgICAgICAgYWxsTXV0YXRvcnMubXVsdGlDbGVhclNlbGVjdGlvbihzdGF0ZSksXG4gICAgICApLFxuICAgICksXG4gICAgLi4uaW5zZXJ0SWY8Uz4oXG4gICAgICBhbGxBY3Rpb25zLmxvYWRQYWdlU3VjY2VzcyAmJiBwYWdpbmF0aW9uQ2FjaGVUeXBlID09PSAncGFydGlhbCcsXG4gICAgICAoKSA9PlxuICAgICAgICBvbihhbGxBY3Rpb25zLmxvYWRQYWdlU3VjY2VzcywgKHN0YXRlKSA9PlxuICAgICAgICAgIGFsbE11dGF0b3JzLm11bHRpQ2xlYXJTZWxlY3Rpb24oc3RhdGUpLFxuICAgICAgICApLFxuICAgICksXG4gICk7XG59XG4iXX0=
